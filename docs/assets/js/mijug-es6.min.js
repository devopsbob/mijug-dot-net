function e(){"undefined"!=typeof globalThis&&void 0!==globalThis.document&&globalThis.document.querySelectorAll([".highlight pre",".language-liquid .highlight pre","pre.highlight",".language-javascript .highlight pre",".language-yaml .highlight pre",".language-markdown .highlight pre",".language-html .highlight pre",".language-css .highlight pre",".language-scss .highlight pre"].join(", ")).forEach(e=>{e.querySelector('code[class*="language-mermaid"], code.mermaid')||(e.scrollWidth>e.clientWidth||e.scrollHeight>e.clientHeight)&&(e.setAttribute("tabindex","0"),e.setAttribute("role","group"),e.setAttribute("aria-label","Scrollable code block"),e.addEventListener("keydown",t=>{switch(t.key){case"ArrowLeft":t.ctrlKey&&(e.scrollLeft-=50,t.preventDefault());break;case"ArrowRight":t.ctrlKey&&(e.scrollLeft+=50,t.preventDefault());break;case"ArrowUp":t.ctrlKey&&(e.scrollTop-=20,t.preventDefault());break;case"ArrowDown":t.ctrlKey&&(e.scrollTop+=20,t.preventDefault());break;case"Home":t.ctrlKey&&(e.scrollLeft=0,t.preventDefault());break;case"End":t.ctrlKey&&(e.scrollLeft=e.scrollWidth,t.preventDefault())}}))})}function t(){"undefined"!=typeof globalThis&&void 0!==globalThis.document&&void 0!==globalThis.window&&globalThis.document.querySelectorAll('a, button, input, select, textarea, [role="button"], [role="link"]').forEach(e=>{const t=e.getBoundingClientRect();if(t.width<44||t.height<44){e.style.minWidth="44px",e.style.minHeight="44px";const t=globalThis.window.getComputedStyle(e).padding;t&&"0px"!==t&&"0px 0px"!==t&&"0px 0px 0px 0px"!==t||(e.style.padding="8px")}})}function o(){globalThis.document?.querySelectorAll("pre > code.language-mermaid, pre > code.mermaid").length>0?setTimeout(()=>{e(),t()},2e3):(e(),t())}if("undefined"!=typeof globalThis&&void 0!==globalThis.document&&("loading"===globalThis.document.readyState?globalThis.document.addEventListener("DOMContentLoaded",o):o()),"undefined"!=typeof globalThis&&void 0!==globalThis.window&&"MutationObserver"in globalThis.window){const e=new MutationObserver(e=>{let t=!1;e.forEach(e=>{"childList"===e.type&&e.addedNodes.length>0&&(t=!0)}),t&&setTimeout(o,100)});void 0!==globalThis.document&&e.observe(globalThis.document.body,{childList:!0,subtree:!0})}class i{copyButtonClass="copy-button";highlightSelector=".highlight, pre";containerSelector=".highlighter-rouge";copySuccessDelay=2e3;accessibilitySettings={copyButtonLabel:"Copy code to clipboard",copySuccessLabel:"Code copied to clipboard",copyFailLabel:"Copy failed - try again",srAnnounceDelay:50};constructor(){this.init()}init(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.setupCodeBlocks()):this.setupCodeBlocks()}setupCodeBlocks(){const e=Array.from(document.querySelectorAll(this.highlightSelector)).filter(e=>{const t=e.tagName?.toLowerCase();if("pre"===t){const t=!!e.querySelector("code"),o=/language-|lang-/.test(e.className),i=!!e.getAttribute("data-lang");return t||o||i}return!0});0!==e.length?(e.forEach(e=>{this.enhanceAccessibility(e),this.addCopyButton(e),this.addKeyboardNavigation(e)}),console.debug(`MIJUG Code Highlighter: Enhanced ${e.length} code blocks`)):console.debug("No code blocks found for highlighter setup")}enhanceAccessibility(e){if(e.hasAttribute("role")||e.setAttribute("role","img"),e.hasAttribute("tabindex")||e.setAttribute("tabindex","0"),!e.hasAttribute("aria-label")){const t=this.detectLanguage(e);e.setAttribute("aria-label",`Code example in ${t}`)}}detectLanguage(e){const t=e.getAttribute("data-lang");if(t)return t;const o=e.closest(this.containerSelector);if(o){const e=o.className.split(" ");for(const t of e)if(t.startsWith("language-"))return t.replace("language-","")}return"code"}addCopyButton(e){const t=this.createCopyButton();let o=e.closest(this.containerSelector);o??=e.parentElement,o?.classList.contains("wrapper")&&(o=e),o??=e,o.classList.contains("highlighter-rouge")||console.debug("MIJUG Code Highlighter: Using fallback container for copy button"),o instanceof HTMLElement&&"static"===getComputedStyle(o).position&&(o.style.position="relative"),o.querySelector(`.${this.copyButtonClass}`)||(o.appendChild(t),t.addEventListener("click",()=>this.handleCopyClick(t,e)),t.addEventListener("keydown",e=>this.handleCopyKeydown(e,t)))}createCopyButton(){const e=document.createElement("button");return e.className=this.copyButtonClass,e.innerHTML='\n      <svg aria-hidden="true" focusable="false" viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg">\n        <path fill="currentColor" d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>\n      </svg>\n      <span class="copy-text">Copy</span>\n    ',e.setAttribute("aria-label",this.accessibilitySettings.copyButtonLabel),e.setAttribute("type","button"),e.setAttribute("tabindex","0"),e}async handleCopyClick(e,t){try{const o=t.querySelector("code");if(!o?.textContent)throw new Error("No code content found to copy");const i=o.textContent.trim();if(!navigator?.clipboard?.writeText)throw new Error("Clipboard API not supported in this browser");await navigator.clipboard.writeText(i),this.showCopySuccess(e),this.announceToScreenReader("Code copied to clipboard")}catch(o){console.error("MIJUG Code Highlighter: Copy failed:",o),this.showCopyError(e),this.fallbackCopy(t,e)}}fallbackCopy(e,t){try{const o=e.querySelector("code");if(!o?.textContent)return;const i=document.createElement("textarea");i.value=o.textContent.trim(),i.style.position="fixed",i.style.opacity="0",i.style.pointerEvents="none",document.body.appendChild(i),i.select();const n=document.execCommand("copy");if(document.body.removeChild(i),!n)throw new Error("Fallback copy failed");this.showCopySuccess(t),this.announceToScreenReader("Code copied to clipboard")}catch(o){console.error("MIJUG Code Highlighter: Fallback copy failed:",o),this.showCopyError(t),this.announceToScreenReader("Copy failed, please try again")}}handleCopyKeydown(e,t){if("Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t.click()),"Escape"===e.key){const e=t.closest(this.containerSelector)?.querySelector(this.highlightSelector);e&&e.focus()}}addKeyboardNavigation(e){e.hasAttribute("tabindex")||e.setAttribute("tabindex","0"),e.addEventListener("keydown",t=>{if("Tab"===t.key&&!t.shiftKey){const o=e.parentElement?.querySelector(`.${this.copyButtonClass}`);o&&(t.preventDefault(),o.focus())}if(("Enter"===t.key||" "===t.key)&&t.ctrlKey){t.preventDefault();const o=e.parentElement?.querySelector(`.${this.copyButtonClass}`);o&&o.click()}})}showCopySuccess(e){const t=e.querySelector(".copy-text"),o=t?.textContent??"Copy",i=e.getAttribute("aria-label");t&&(t.textContent="Copied!"),e.setAttribute("aria-label",this.accessibilitySettings.copySuccessLabel),e.classList.add("copied"),setTimeout(()=>{t&&(t.textContent=o),e.setAttribute("aria-label",i??this.accessibilitySettings.copyButtonLabel),e.classList.remove("copied")},this.copySuccessDelay)}showCopyError(e){const t=e.querySelector(".copy-text"),o=t?.textContent??"Copy",i=e.getAttribute("aria-label");t&&(t.textContent="Failed"),e.setAttribute("aria-label",this.accessibilitySettings.copyFailLabel),e.classList.add("error"),setTimeout(()=>{t&&(t.textContent=o),e.setAttribute("aria-label",i??this.accessibilitySettings.copyButtonLabel),e.classList.remove("error")},this.copySuccessDelay)}announceToScreenReader(e){let t=document.getElementById("sr-announcer");t||(t=document.createElement("div"),t.id="sr-announcer",t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.classList.add("sr-only"),t.style.position="absolute",t.style.width="1px",t.style.height="1px",t.style.padding="0",t.style.margin="-1px",t.style.overflow="hidden",t.style.clip="rect(0, 0, 0, 0)",t.style.whiteSpace="nowrap",t.style.border="0",document.body.appendChild(t)),setTimeout(()=>{t&&(t.textContent=e)},this.accessibilitySettings.srAnnounceDelay)}}new i;let n=null,l=null,a=null,s=null,r=null;function c(e){"undefined"!=typeof globalThis&&globalThis.window?.requestIdleCallback?globalThis.window.requestIdleCallback(e,{timeout:1e3}):"undefined"!=typeof setTimeout?setTimeout(e,16):e()}function d(){"undefined"!=typeof globalThis&&void 0!==globalThis.document&&(n??=(new Date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),c(()=>{l??=(()=>{const e=globalThis.document.querySelector('meta[name="version"]');return e?.content??n})(),a??=globalThis.document.title.split(" | ")[0]??globalThis.document.title,void 0!==globalThis.requestAnimationFrame&&globalThis.requestAnimationFrame(()=>{globalThis.document.body.setAttribute("data-print-date",n),globalThis.document.body.setAttribute("data-version",l),globalThis.document.body.setAttribute("data-document-title",a),c(()=>u(n,l))})}))}function u(e,t){if("undefined"==typeof globalThis||void 0===globalThis.document)return;const o=globalThis.document.getElementById("print-date-css");o&&o.remove();const i=globalThis.document.createElement("style");i.id="print-date-css",i.textContent=`\n    @media print {\n      @page {\n        @bottom-center {\n          content: "Printed: ${e} | Modified: ${t}";\n          font-size: 9pt;\n          color: #666;\n        }\n      }\n    }\n  `;const n=globalThis.document.createDocumentFragment();n.appendChild(i),globalThis.document.head.appendChild(n)}function h(){"undefined"!=typeof globalThis&&void 0!==globalThis.window&&(s&&clearTimeout(s),s=globalThis.window.setTimeout(()=>{const e=(new Date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});"undefined"!=typeof globalThis&&void 0!==globalThis.requestAnimationFrame&&void 0!==globalThis.document&&globalThis.requestAnimationFrame(()=>{globalThis.document.body.setAttribute("data-print-date",e);const t=l??e;c(()=>u(e,t))})},10))}"undefined"!=typeof globalThis&&void 0!==globalThis.document&&("loading"===globalThis.document.readyState?globalThis.document.addEventListener("DOMContentLoaded",d,{passive:!0}):c(d)),"undefined"!=typeof globalThis&&void 0!==globalThis.window&&globalThis.window.addEventListener("beforeprint",h,{passive:!0}),"undefined"!=typeof globalThis&&void 0!==globalThis.document&&globalThis.document.addEventListener("keydown",function(e){(e.ctrlKey||e.metaKey)&&"p"===e.key&&(r&&clearTimeout(r),r=globalThis.window?.setTimeout(h,10)??0)},{passive:!0});let g=null;function b(){return g??="undefined"!=typeof globalThis&&void 0!==globalThis.document&&"function"==typeof globalThis.document.hasStorageAccess&&"function"==typeof globalThis.document.requestStorageAccess,g}async function p(){if(!b())return console.debug("Storage Access API not supported in this browser"),!1;try{return await(globalThis.document.hasStorageAccess?.())?(console.debug("Storage access already granted"),!0):(await(globalThis.document.requestStorageAccess?.()),console.debug("Storage access granted"),!0)}catch(e){return console.error("Storage access denied or failed:",e),!1}}function y(){"undefined"!=typeof globalThis&&void 0!==globalThis.document&&(!function(){if("undefined"!=typeof globalThis&&void 0!==globalThis.document&&!globalThis.document.querySelector('meta[http-equiv="Permissions-Policy"]')){const e=globalThis.document.createElement("meta");e.httpEquiv="Permissions-Policy",e.content='storage-access=(self "https://calendar.google.com" "https://www.google.com")',globalThis.document.head.appendChild(e)}}(),"undefined"!=typeof globalThis&&void 0!==globalThis.document&&(globalThis.document.querySelectorAll('[src*="calendar.google.com"], [href*="calendar.google.com"]').forEach(e=>{e.addEventListener("click",()=>{p().catch(e=>{console.error("Failed to request storage access:",e)})})}),globalThis.document.querySelectorAll('iframe[src*="calendar.google.com"]').forEach(e=>{e.addEventListener("load",()=>{p().catch(e=>{console.error("Failed to request storage access for iframe:",e)})})})),new MutationObserver(e=>{e.forEach(e=>{e.addedNodes.forEach(e=>{if(e.nodeType===Node.ELEMENT_NODE){const t=e;(t.querySelectorAll?t.querySelectorAll('[src*="calendar.google.com"], [href*="calendar.google.com"]'):[]).forEach(e=>{e.addEventListener("click",()=>{p().catch(e=>{console.error("Failed to request storage access for dynamic content:",e)})})})}})})}).observe(globalThis.document.body,{childList:!0,subtree:!0}))}function m(){"undefined"!=typeof globalThis&&globalThis.window?.MIJUG_DISABLE_PRINT&&"undefined"!=typeof globalThis&&void 0!==globalThis.window&&(globalThis.window.print=function(){console.debug("Print functionality disabled")},globalThis.window.addEventListener("keydown",function(e){if(80===e.keyCode&&(e.ctrlKey||e.metaKey)&&!e.altKey&&(!e.shiftKey||void 0!==globalThis.window?.chrome||void 0!==globalThis.window?.opera))return e.preventDefault(),void(e.stopImmediatePropagation?e.stopImmediatePropagation():e.stopPropagation());!e.ctrlKey||"p"!==e.key&&"s"!==e.key||e.preventDefault()},!0))}"undefined"!=typeof globalThis&&void 0!==globalThis.document&&("loading"===globalThis.document.readyState?globalThis.document.addEventListener("DOMContentLoaded",y):y()),"undefined"!=typeof globalThis&&void 0!==globalThis.window&&(globalThis.window.MIJUG=globalThis.window.MIJUG??{},globalThis.window.MIJUG.storageAccess={request:p,isSupported:b}),new i,m();export{m as maybeDisablePrint};
